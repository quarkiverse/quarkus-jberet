<?xml version="1.0" encoding="UTF-8"?>
<job id="jdbc-properties" xmlns="http://xmlns.jcp.org/xml/ns/javaee" version="1.0">
    <step id="jdbcStep">
        <chunk item-count="3">
            <reader ref="jdbcItemReader">
                <properties>
                    <property name="sql" value="SELECT itemId, sum(quantity), sum(bid), sum(buyout), min(bid / quantity), min(buyout / quantity), max(bid / quantity), max(buyout / quantity) FROM Auctions GROUP BY itemId ORDER BY 1"/>
                    <property name="rowMapper" value="auctionStatisticsRowMapper"/>
                    <property name="connectionAutoCommit" value="false"/>
                    <property name="fetchSize" value="1"/>
                </properties>
            </reader>
            <writer ref="jdbcItemWriter">
                <properties>
                    <property name="sql" value="INSERT INTO AuctionStatistics (id, itemId, quantity, bid, minBid, maxBid, buyout, minBuyout, maxBuyout, avgBid, avgBuyout, timestamp ) VALUES (nextval('auction_statistics_id'), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"/>
                    <property name="parameterSetter" value="auctionStatisticsParameterSetter"/>
                </properties>
            </writer>
        </chunk>
    </step>
</job>
